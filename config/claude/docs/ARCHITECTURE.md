# Architecture

This document describes how the Claude Code setup is structured.

## Layers

### Global Config (~/.claude/, symlinked from dotfiles)

- **CLAUDE.md** — Identity, principles, security rules, workflow docs
- **settings.json** — Permissions (deny/ask/allow), hooks, notifications
- **commands/** — Slash commands invoked explicitly by the user
- **skills/** — Auto-discovered conventions Claude applies based on context
- **agents/** — Sub-agent definitions for pipeline workflow delegation

### Per-Project Config (generated by /init-project)

- **CLAUDE.md** at project root — stack, conventions, architecture, gotchas
- **.claude/settings.json** — project-specific permissions (shared with team)
- **.claude/settings.local.json** — personal overrides (gitignored)

### How They Merge

Claude Code loads global first, then project. Deny always wins over allow.
Project-level settings override global for allow/ask rules.

## Security Model (Three Layers)

1. **Permissions** (settings.json) — declarative deny/ask/allow rules
2. **Hooks** (settings.json) — prompt-based PreToolUse evaluation of commands
3. **CLAUDE.md directives** — behavioral rules Claude follows as instructions

All three are independent. If one fails, the others still protect.

## Workflows

Two workflows: Simple (no ceremony) and Pipeline (structured with gates).
See WORKFLOWS.md for full documentation.

## Commands vs Skills vs Agents

| Type     | Invocation                           | Purpose                         |
| -------- | ------------------------------------ | ------------------------------- |
| Commands | Explicit (`/command`)                | Trigger workflows and actions   |
| Skills   | Automatic (Claude reads description) | Apply conventions and standards |
| Agents   | Via Task tool in pipelines           | Delegate focused sub-tasks      |
