#!/usr/bin/env bash
set -euo pipefail

DOTFILES_DIR="${DOTFILES_DIR:-$HOME/.dotfiles}"
TEMPLATE="$DOTFILES_DIR/config/copilot/copilot-instructions.md"
TARGET=".github/copilot-instructions.md"

# Check if we're in a git repo
if ! git rev-parse --git-dir >/dev/null 2>&1; then
	echo "Error: Not in a git repository"
	exit 1
fi

# Check if template exists
if [[ ! -f "$TEMPLATE" ]]; then
	echo "Error: Template not found at $TEMPLATE"
	exit 1
fi

# Create .github directory if needed
mkdir -p .github

# Copy template if it doesn't exist
if [[ ! -f "$TARGET" ]]; then
	cp "$TEMPLATE" "$TARGET"
	echo "Created $TARGET"
fi

cat << 'BANNER'
╔═══════════════════════════════════════════════════════════════════╗
║                     Copilot Project Setup                         ║
╠═══════════════════════════════════════════════════════════════════╣
║                                                                   ║
║  1. Run: claude                                                   ║
║  2. Paste the prompt below                                        ║
║                                                                   ║
╚═══════════════════════════════════════════════════════════════════╝

BANNER

cat << 'PROMPT'
────────────────────────────────────────────────────────────────────
PROMPT TO PASTE:
────────────────────────────────────────────────────────────────────

Explore this codebase thoroughly with extended thinking. Analyze:

- Tech stack and frameworks used
- Project structure and architecture patterns
- Testing patterns and conventions
- Naming conventions and code style
- Build/dev/test commands in package.json or similar

Then update .github/copilot-instructions.md:

1. Keep the existing template structure
2. Fill in the "Project Context" section at the bottom with:
   - Brief project description
   - Key directories and their purposes
   - Project-specific patterns or conventions
   - Common commands (dev, build, test, lint)
   - Any gotchas or important notes

Keep it concise - Copilot uses this for inline completions.

────────────────────────────────────────────────────────────────────
PROMPT
