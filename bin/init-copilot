#!/bin/bash
set -euo pipefail

DOTFILES_DIR="${DOTFILES_DIR:-$HOME/.dotfiles}"
TEMPLATE="$DOTFILES_DIR/config/copilot/copilot-instructions.md"
TARGET=".github/copilot-instructions.md"

# Check if we're in a git repo
if ! git rev-parse --git-dir >/dev/null 2>&1; then
	echo "Error: Not in a git repository"
	exit 1
fi

# Check if template exists
if [[ ! -f "$TEMPLATE" ]]; then
	echo "Error: Template not found at $TEMPLATE"
	exit 1
fi

# Check if target already exists
if [[ -f "$TARGET" ]]; then
	echo "Error: $TARGET already exists"
	echo "       Remove it first if you want to reinitialize"
	exit 1
fi

# Create .github directory if needed
mkdir -p .github

# Copy template
cp "$TEMPLATE" "$TARGET"

echo "Created $TARGET"
echo "Edit it to add project-specific instructions"
